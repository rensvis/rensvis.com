---
import { getCollection, render } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import Callout from '../../components/article/Callout.astro';
import Figure from '../../components/article/Figure.astro';
import AuthorBlock from '../../components/article/AuthorBlock.astro';
import { SITE } from '../../lib/site';
import { articleSchema } from '../../lib/structured-data';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((entry) => ({
    params: { slug: entry.id },
    props: { entry },
  }));
}

interface Props {
  entry: Awaited<ReturnType<typeof getCollection>>[number];
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const mdxComponents = {
  Callout,
  Figure,
};
---

<PageLayout
  title={`${entry.data.title} | ${SITE.name}`}
  description={entry.data.description}
  canonical={`/articles/${entry.id}`}
  structuredData={articleSchema(entry)}
>
  <ArticleLayout entry={entry}>
    <article class="prose prose-neutral prose-lg dark:prose-invert mx-auto max-w-2xl px-4 py-16" data-pagefind-body>
      <Content components={mdxComponents} />
    </article>
    <div class="container mx-auto max-w-2xl px-4 pb-16">
      <AuthorBlock />
    </div>
  </ArticleLayout>
</PageLayout>
