---
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';
import { SITE } from '../../lib/site';

const articles = await getCollection('articles');
const tagCounts = articles.reduce<Record<string, number>>((acc, entry) => {
  for (const tag of entry.data.tags) {
    acc[tag] = (acc[tag] ?? 0) + 1;
  }
  return acc;
}, {});
const tags = Object.entries(tagCounts).sort(
  ([, a]: [string, number], [, b]: [string, number]) => b - a
);
---

<PageLayout title={`Tags | ${SITE.name}`} description={`Browse articles by tag.`}>
  <main class="container mx-auto max-w-2xl px-4 py-16">
    <h1>Tags</h1>
    <p class="mt-2 text-muted-foreground">
      {tags.length} tag{tags.length === 1 ? '' : 's'}
    </p>
    <ul class="mt-8 flex flex-wrap gap-2">
      {tags.map(([tag, count]) => (
        <li>
          <a
            href={`/tags/${tag}`}
            class="inline-flex items-center rounded-full border border-border px-3 py-1 text-sm transition-colors hover:bg-muted"
          >
            {tag}
            <span class="ml-1.5 text-muted-foreground">({count})</span>
          </a>
        </li>
      ))}
    </ul>
  </main>
</PageLayout>
