---
import { SITE } from '@/lib/site';

interface Props {
  title: string;
  description?: string;
  canonical?: string;
  image?: string;
  structuredData?: string;
}

const { title, description, canonical, image, structuredData } = Astro.props;

const siteUrl = SITE.url.replace(/\/$/, '');
const canonicalUrl = canonical ? (canonical.startsWith('http') ? canonical : `${siteUrl}${canonical.startsWith('/') ? '' : '/'}${canonical}`) : Astro.url.href;
const imageUrl = image ? (image.startsWith('http') ? image : `${siteUrl}${image.startsWith('/') ? image : `/${image}`}`) : `${siteUrl}/images/avatar.svg`;
---

<meta charset="utf-8" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" href="/favicon.ico" />
<meta name="viewport" content="width=device-width" />
<meta name="generator" content={Astro.generator} />

<!-- Primary meta -->
<title>{title}</title>
{description && <meta name="description" content={description} />}
<link rel="canonical" href={canonicalUrl} />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content={title} />
{description && <meta property="og:description" content={description} />}
<meta property="og:url" content={canonicalUrl} />
<meta property="og:image" content={imageUrl} />
<meta property="og:site_name" content={SITE.name} />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
{description && <meta name="twitter:description" content={description} />}
<meta name="twitter:image" content={imageUrl} />

<!-- Structured Data -->
{structuredData && (
  <script type="application/ld+json" set:html={structuredData} />
)}

<!-- Umami Analytics (optional) -->
{import.meta.env.PUBLIC_UMAMI_WEBSITE_ID && (
  <script
    defer
    src={import.meta.env.PUBLIC_UMAMI_URL || 'https://analytics.umami.is/script.js'}
    data-website-id={import.meta.env.PUBLIC_UMAMI_WEBSITE_ID}
    data-domains={SITE.url.replace(/^https?:\/\//, '')}
  />
)}
